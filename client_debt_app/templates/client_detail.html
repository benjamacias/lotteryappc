{% extends 'layout.html' %}
{% block title %}{{ client.name }}{% endblock %}
{% block content %}
  <h1 class="text-2xl font-bold mb-4">{{ client.name }}</h1>
  <p class="mb-1"><strong>Documento:</strong> {{ client.document }}</p>
  <p class="mb-1"><strong>Dirección:</strong> {{ client.address or '-' }}</p>
  <p class="mb-1"><strong>Teléfono:</strong> {{ client.phone or '-' }}</p>
  <p class="mb-4"><strong>Deuda total:</strong> ${{ '%.2f'|format(client.total_debt) }}</p>

  <h2 class="text-xl font-semibold mb-2">Deudas</h2>
  <table class="min-w-full bg-white mb-4">
    <thead>
      <tr class="border-b">
        <th class="text-left py-2 px-3">Fecha</th>
        <th class="text-left py-2 px-3">Monto</th>
        <th class="text-left py-2 px-3">Descripción</th>
      </tr>
    </thead>
    <tbody>
      {% for d in client.debts %}
      <tr class="border-b">
        <td class="py-2 px-3">{{ d.date.strftime('%d/%m/%Y') }}</td>
        <td class="py-2 px-3">${{ '%.2f'|format(d.amount) }}</td>
        <td class="py-2 px-3">{{ d.description }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3 class="text-lg font-semibold mb-2">Agregar deuda</h3>
  <form action="{{ url_for('add_debt', client_id=client.id) }}" method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    {{ debt_form.csrf_token }}
    <div>
      {{ debt_form.date.label(class="block mb-1") }}
      {{ debt_form.date(class="border rounded w-full px-3 py-2") }}
    </div>
    <div>
      {{ debt_form.amount.label(class="block mb-1") }}
      {{ debt_form.amount(class="border rounded w-full px-3 py-2", step="0.01") }}
    </div>
    <div class="md:col-span-1">
      {{ debt_form.description.label(class="block mb-1") }}
      {{ debt_form.description(class="border rounded w-full px-3 py-2") }}
    </div>
    <div class="md:col-span-3">
      {{ debt_form.submit(class="bg-blue-500 text-white px-4 py-2 rounded") }}
    </div>
  </form>

  <h2 class="text-xl font-semibold mb-2">Pagos</h2>
  <table class="min-w-full bg-white mb-4">
    <thead>
      <tr class="border-b">
        <th class="text-left py-2 px-3">Fecha</th>
        <th class="text-left py-2 px-3">Monto</th>
        <th class="text-left py-2 px-3">Método</th>
      </tr>
    </thead>
    <tbody>
      {% for p in client.payments %}
      <tr class="border-b">
        <td class="py-2 px-3">{{ p.date.strftime('%d/%m/%Y') }}</td>
        <td class="py-2 px-3">${{ '%.2f'|format(p.amount) }}</td>
        <td class="py-2 px-3">{{ p.method_label }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <h3 class="text-lg font-semibold mb-2">Agregar pago</h3>
  <form action="{{ url_for('add_payment', client_id=client.id) }}" method="post" class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
    {{ payment_form.csrf_token }}
    <div>
      {{ payment_form.date.label(class="block mb-1") }}
      {{ payment_form.date(class="border rounded w-full px-3 py-2") }}
    </div>
    <div>
      {{ payment_form.amount.label(class="block mb-1") }}
      {{ payment_form.amount(class="border rounded w-full px-3 py-2", step="0.01") }}
    </div>
    <div>
      {{ payment_form.method.label(class="block mb-1") }}
      {{ payment_form.method(class="border rounded w-full px-3 py-2") }}
    </div>
    <div class="md:col-span-3">
      {{ payment_form.submit(class="bg-green-500 text-white px-4 py-2 rounded") }}
    </div>
  </form>

  <h2 class="text-xl font-semibold mb-2">Movimientos</h2>
  <table class="min-w-full bg-white mb-4">
    <thead>
      <tr class="border-b">
        <th class="text-left py-2 px-3">Fecha</th>
        <th class="text-left py-2 px-3">Acción</th>
        <th class="text-left py-2 px-3">Monto</th>
        <th class="text-left py-2 px-3">Descripción</th>
      </tr>
    </thead>
    <tbody>
      {% for m in client.movements %}
      <tr class="border-b">
        <td class="py-2 px-3">{{ m.timestamp.strftime('%d/%m/%Y %H:%M') }}</td>
        <td class="py-2 px-3">{{ m.action }}</td>
        <td class="py-2 px-3">{% if m.amount %}${{ '%.2f'|format(m.amount) }}{% else %}-{% endif %}</td>
        <td class="py-2 px-3">{{ m.description }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{{ url_for('index') }}" class="inline-block bg-gray-500 text-white px-4 py-2 rounded">Volver</a>
{% endblock %}
